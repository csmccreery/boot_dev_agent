from pathlib import Path
from os.path import getsize

class PathManager:
    def __init__(self, working_dir, path):
        self.absolute_working_dir = Path(working_dir).absolute()
        self.target_path = (absolute_working_dir / path).resolve()
        self.common_path = self.get_common_path()

    def get_common_path(self):
        zipped_parts = zip(*(p.parts for p in [self.absolute_working_dir, self.target_path]))

        common_parts = []
        for part_tuple in zipped_parts:
            if len(set(part_tuple)) == 1:
                common_parts.append(part_tuple[0])
            else:
                break

        return Path(*common_parts)

    def validate_dir(working_dir, dir):
        absolute_working_dir = Path(working_dir).absolute()
        target_dir = (absolute_working_dir / dir).resolve()

        if not Path(target_dir).is_dir():
            return f"Error: '{dir}' is not a directory"

        if not common_path == absolute_working_dir:
            return f"Error: Cannot list '{dir}' as it is outside the permitted working directory"

        return None

    def validate_file(working_dir, dir):
        if self.target_dir.is_dir():
            return f"Error: '{dir}' is a directory"

        if not self.common_path == self.absolute_working_dir:
            return f"Error: Cannot list '{dir}' as it is outside the permitted working directory"

        return None
